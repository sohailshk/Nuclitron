<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Text-to-Speech Demo</title>
    <style>
      :root { color-scheme: light dark; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; padding: 24px; line-height: 1.5; }
      .container { max-width: 900px; margin: 0 auto; }
      h1 { font-size: 1.5rem; margin: 0 0 16px; }
      .row { display: flex; gap: 16px; flex-wrap: wrap; }
      .field { display: flex; flex-direction: column; gap: 6px; min-width: 220px; flex: 1; }
      label { font-weight: 600; }
      select, textarea, input[type="range"] { width: 100%; }
      textarea { min-height: 140px; resize: vertical; padding: 10px; }
      .actions { display: flex; gap: 10px; margin-top: 12px; }
      button { padding: 10px 14px; font-weight: 600; cursor: pointer; }
      .small { font-size: 0.9rem; color: #666; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Text-to-Speech (Web Speech API)</h1>
      <div class="row">
        <div class="field">
          <label for="text">Text</label>
          <textarea id="text" placeholder="Type or paste text in any supported language..."></textarea>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="lang">Language (BCP-47)</label>
          <input id="lang" type="text" placeholder="e.g., en-US, hi-IN, es-ES" />
          <div class="small">Leave empty to use the selected voice language.</div>
        </div>
        <div class="field">
          <label for="voice">Voice</label>
          <select id="voice"></select>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="rate">Rate: <span id="rateVal">1.0</span></label>
          <input id="rate" type="range" min="0.5" max="2" step="0.1" value="1" />
        </div>
        <div class="field">
          <label for="pitch">Pitch: <span id="pitchVal">1.0</span></label>
          <input id="pitch" type="range" min="0" max="2" step="0.1" value="1" />
        </div>
        <div class="field">
          <label for="volume">Volume: <span id="volumeVal">1.0</span></label>
          <input id="volume" type="range" min="0" max="1" step="0.05" value="1" />
        </div>
      </div>

      <div class="actions">
        <button id="speak">Speak</button>
        <button id="stop">Stop</button>
        <button id="pause">Pause</button>
        <button id="resume">Resume</button>
      </div>

      <p class="small">
        Tip: On first use, some browsers need a user gesture (click) to start audio.
      </p>
    </div>

    <script src="tts.js"></script>
    <script>
      const voiceSelect = document.getElementById('voice');
      const langInput = document.getElementById('lang');
      const textArea = document.getElementById('text');
      const rate = document.getElementById('rate');
      const rateVal = document.getElementById('rateVal');
      const pitch = document.getElementById('pitch');
      const pitchVal = document.getElementById('pitchVal');
      const volume = document.getElementById('volume');
      const volumeVal = document.getElementById('volumeVal');

      function populateVoices() {
        const voices = window.TTS.getVoices();
        const selected = voiceSelect.value;
        voiceSelect.innerHTML = '';
        voices
          .sort((a, b) => (a.lang || '').localeCompare(b.lang || '') || (a.name || '').localeCompare(b.name || ''))
          .forEach(v => {
            const opt = document.createElement('option');
            opt.value = v.name;
            opt.textContent = `${v.name} — ${v.lang}${v.default ? ' (default)' : ''}`;
            voiceSelect.appendChild(opt);
          });
        if (selected) {
          voiceSelect.value = selected;
        }
      }

      if (!window.TTS.isSupported) {
        alert('Web Speech API not supported in this browser. Please use Chrome, Edge, or Safari.');
      }

      // Update preview labels
      const updateLabels = () => {
        rateVal.textContent = Number(rate.value).toFixed(1);
        pitchVal.textContent = Number(pitch.value).toFixed(1);
        volumeVal.textContent = Number(volume.value).toFixed(2);
      };
      ['input', 'change'].forEach(ev => {
        rate.addEventListener(ev, updateLabels);
        pitch.addEventListener(ev, updateLabels);
        volume.addEventListener(ev, updateLabels);
      });
      updateLabels();

      window.TTS.onVoicesChanged(populateVoices);
      populateVoices();

      // If options change during playback, restart with new settings using the current textarea value
      const reSpeakIfPlaying = () => {
        if (!window.TTS.isSpeaking()) return;
        const text = textArea.value || '';
        if (!text.trim()) return;
        window.TTS.speak(text, {
          lang: (langInput.value || undefined),
          voiceName: (voiceSelect.value || undefined),
          rate: parseFloat(rate.value),
          pitch: parseFloat(pitch.value),
          volume: parseFloat(volume.value),
          interrupt: true
        });
      };

      [rate, pitch, volume, voiceSelect, langInput].forEach(el => {
        const evt = (el === voiceSelect) ? 'change' : 'input';
        el.addEventListener(evt, reSpeakIfPlaying);
      });

      document.getElementById('speak').addEventListener('click', () => {
        const text = textArea.value || 'Hello! नमस्ते! Hola! こんにちは! مرحبا!';
        window.TTS.speak(text, {
          lang: (langInput.value || undefined),
          voiceName: (voiceSelect.value || undefined),
          rate: parseFloat(rate.value),
          pitch: parseFloat(pitch.value),
          volume: parseFloat(volume.value),
          interrupt: true
        });
      });
      document.getElementById('stop').addEventListener('click', () => window.TTS.stop());
      document.getElementById('pause').addEventListener('click', () => window.TTS.pause());
      document.getElementById('resume').addEventListener('click', () => window.TTS.resume());
    </script>
  </body>
  </html>


